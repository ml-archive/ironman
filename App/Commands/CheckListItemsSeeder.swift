import Console
import MySQL

public final class CheckListItemsSeeder: Command {
    public let id = "seeder:checklist"

    public let help: [String] = [
            "Seeds the database with checlist items"
    ]

    public let console: ConsoleProtocol

    public init(console: ConsoleProtocol) {
        self.console = console
    }

    public func run(arguments: [String]) throws {

        console.info("Started the seeder for checklists");
        /*
        let mysql = try MySQL.Database(
            host: "127.0.0.1",
            user: "root",
            password: "secret",
            database: "ironman-old"
        )
        
        let result = try mysql.execute("SELECT * FROM checklist_items")
        */
        
        let result = [["position": Node.number(0), "modified": Node.string("2014-06-02 11:01:58"), "id": Node.number(2), "created": Node.string("2014-06-02 11:01:58"), "is_active": Node.number(1), "race_id": Node.number(26), "title": Node.string("Valid triathlon license"), "type": Node.string("registration")], ["position": Node.number(1), "modified": Node.string("2014-06-02 11:02:04"), "id": Node.number(3), "created": Node.string("2014-06-02 11:02:04"), "is_active": Node.number(1), "race_id": Node.number(26), "title": Node.string("Valid picture ID"), "type": Node.string("registration")], ["position": Node.number(0), "modified": Node.string("2014-06-02 11:02:24"), "id": Node.number(5), "created": Node.string("2014-06-02 11:02:24"), "is_active": Node.number(1), "race_id": Node.number(26), "title": Node.string("Bike"), "type": Node.string("check_in")], ["position": Node.number(1), "modified": Node.string("2014-06-02 11:02:30"), "id": Node.number(8), "created": Node.string("2014-06-02 11:02:30"), "is_active": Node.number(1), "race_id": Node.number(26), "title": Node.string("Helmet"), "type": Node.string("check_in")], ["position": Node.number(2), "modified": Node.string("2014-06-02 11:02:36"), "id": Node.number(9), "created": Node.string("2014-06-02 11:02:36"), "is_active": Node.number(1), "race_id": Node.number(26), "title": Node.string("BLUE bike bag"), "type": Node.string("check_in")], ["position": Node.number(3), "modified": Node.string("2014-06-02 11:02:41"), "id": Node.number(10), "created": Node.string("2014-06-02 11:02:41"), "is_active": Node.number(1), "race_id": Node.number(26), "title": Node.string("RED run bag"), "type": Node.string("check_in")], ["position": Node.number(0), "modified": Node.string("2014-06-02 11:03:09"), "id": Node.number(12), "created": Node.string("2014-06-02 11:03:09"), "is_active": Node.number(1), "race_id": Node.number(26), "title": Node.string("WHITE after race bag"), "type": Node.string("race_morning")], ["position": Node.number(1), "modified": Node.string("2014-06-02 11:03:14"), "id": Node.number(13), "created": Node.string("2014-06-02 11:03:14"), "is_active": Node.number(1), "race_id": Node.number(26), "title": Node.string("Wetsuit"), "type": Node.string("race_morning")], ["position": Node.number(2), "modified": Node.string("2014-06-02 11:03:20"), "id": Node.number(16), "created": Node.string("2014-06-02 11:03:20"), "is_active": Node.number(1), "race_id": Node.number(26), "title": Node.string("Swim googles"), "type": Node.string("race_morning")], ["position": Node.number(3), "modified": Node.string("2014-06-02 11:03:25"), "id": Node.number(19), "created": Node.string("2014-06-02 11:03:25"), "is_active": Node.number(1), "race_id": Node.number(26), "title": Node.string("Bike shoes"), "type": Node.string("race_morning")], ["position": Node.number(4), "modified": Node.string("2014-06-02 11:03:31"), "id": Node.number(22), "created": Node.string("2014-06-02 11:03:31"), "is_active": Node.number(1), "race_id": Node.number(26), "title": Node.string("Sun glasses"), "type": Node.string("race_morning")], ["position": Node.number(5), "modified": Node.string("2014-06-02 11:03:38"), "id": Node.number(24), "created": Node.string("2014-06-02 11:03:38"), "is_active": Node.number(1), "race_id": Node.number(26), "title": Node.string("Official swim cap"), "type": Node.string("race_morning")], ["position": Node.number(6), "modified": Node.string("2014-06-02 11:03:44"), "id": Node.number(25), "created": Node.string("2014-06-02 11:03:44"), "is_active": Node.number(1), "race_id": Node.number(26), "title": Node.string("Race number"), "type": Node.string("race_morning")], ["position": Node.number(7), "modified": Node.string("2014-06-02 11:03:50"), "id": Node.number(27), "created": Node.string("2014-06-02 11:03:50"), "is_active": Node.number(1), "race_id": Node.number(26), "title": Node.string("Timing chip"), "type": Node.string("race_morning")], ["position": Node.number(0), "modified": Node.string("2014-06-15 14:11:39"), "id": Node.number(29), "created": Node.string("2014-06-15 14:11:39"), "is_active": Node.number(1), "race_id": Node.number(31), "title": Node.string("Valid triathlon license to nationale federation"), "type": Node.string("registration")], ["position": Node.number(1), "modified": Node.string("2014-06-15 14:11:53"), "id": Node.number(30), "created": Node.string("2014-06-15 14:11:53"), "is_active": Node.number(1), "race_id": Node.number(31), "title": Node.string("Picture ID"), "type": Node.string("registration")], ["position": Node.number(2), "modified": Node.string("2014-06-15 14:12:10"), "id": Node.number(33), "created": Node.string("2014-06-15 14:12:10"), "is_active": Node.number(1), "race_id": Node.number(31), "title": Node.string("Race start number"), "type": Node.string("registration")], ["position": Node.number(0), "modified": Node.string("2014-06-15 14:13:49"), "id": Node.number(34), "created": Node.string("2014-06-15 14:13:49"), "is_active": Node.number(1), "race_id": Node.number(31), "title": Node.string("Bike"), "type": Node.string("check_in")], ["position": Node.number(1), "modified": Node.string("2014-06-15 14:13:59"), "id": Node.number(36), "created": Node.string("2014-06-15 14:13:59"), "is_active": Node.number(1), "race_id": Node.number(31), "title": Node.string("Helmet"), "type": Node.string("check_in")], ["position": Node.number(2), "modified": Node.string("2014-06-15 14:14:16"), "id": Node.number(37), "created": Node.string("2014-06-15 14:14:16"), "is_active": Node.number(1), "race_id": Node.number(31), "title": Node.string("BLUE bike bag"), "type": Node.string("check_in")], ["position": Node.number(3), "modified": Node.string("2014-06-15 14:14:34"), "id": Node.number(38), "created": Node.string("2014-06-15 14:14:34"), "is_active": Node.number(1), "race_id": Node.number(31), "title": Node.string("RED run bag"), "type": Node.string("check_in")], ["position": Node.number(0), "modified": Node.string("2014-06-15 14:15:21"), "id": Node.number(40), "created": Node.string("2014-06-15 14:15:21"), "is_active": Node.number(1), "race_id": Node.number(31), "title": Node.string("WHITE after race bag"), "type": Node.string("race_morning")], ["position": Node.number(1), "modified": Node.string("2014-06-15 14:15:36"), "id": Node.number(43), "created": Node.string("2014-06-15 14:15:36"), "is_active": Node.number(1), "race_id": Node.number(31), "title": Node.string("Wetsuit"), "type": Node.string("race_morning")], ["position": Node.number(2), "modified": Node.string("2014-06-15 14:15:50"), "id": Node.number(46), "created": Node.string("2014-06-15 14:15:50"), "is_active": Node.number(1), "race_id": Node.number(31), "title": Node.string("Bike shoes "), "type": Node.string("race_morning")], ["position": Node.number(3), "modified": Node.string("2014-06-15 14:16:03"), "id": Node.number(49), "created": Node.string("2014-06-15 14:16:03"), "is_active": Node.number(1), "race_id": Node.number(31), "title": Node.string("Sun glasses"), "type": Node.string("race_morning")], ["position": Node.number(4), "modified": Node.string("2014-06-15 14:16:21"), "id": Node.number(51), "created": Node.string("2014-06-15 14:16:21"), "is_active": Node.number(1), "race_id": Node.number(31), "title": Node.string("Official swim cap"), "type": Node.string("race_morning")], ["position": Node.number(5), "modified": Node.string("2014-06-15 14:16:42"), "id": Node.number(54), "created": Node.string("2014-06-15 14:16:42"), "is_active": Node.number(1), "race_id": Node.number(31), "title": Node.string("Race number"), "type": Node.string("race_morning")], ["position": Node.number(6), "modified": Node.string("2014-06-15 14:17:10"), "id": Node.number(56), "created": Node.string("2014-06-15 14:17:10"), "is_active": Node.number(1), "race_id": Node.number(31), "title": Node.string("TIming chip"), "type": Node.string("race_morning")], ["position": Node.number(7), "modified": Node.string("2014-06-15 14:17:29"), "id": Node.number(57), "created": Node.string("2014-06-15 14:17:29"), "is_active": Node.number(1), "race_id": Node.number(31), "title": Node.string("Swim goggles"), "type": Node.string("race_morning")], ["position": Node.number(8), "modified": Node.string("2014-06-15 14:17:42"), "id": Node.number(58), "created": Node.string("2014-06-15 14:17:42"), "is_active": Node.number(1), "race_id": Node.number(31), "title": Node.string("Sunblock"), "type": Node.string("race_morning")], ["position": Node.number(0), "modified": Node.string("2014-09-07 21:21:17"), "id": Node.number(59), "created": Node.string("2014-09-07 21:21:17"), "is_active": Node.number(1), "race_id": Node.number(33), "title": Node.string("Proof of membership of national triathlon federation"), "type": Node.string("registration")], ["position": Node.number(1), "modified": Node.string("2014-09-07 21:21:27"), "id": Node.number(61), "created": Node.string("2014-09-07 21:21:27"), "is_active": Node.number(1), "race_id": Node.number(33), "title": Node.string("Picture ID"), "type": Node.string("registration")], ["position": Node.number(0), "modified": Node.string("2014-09-07 21:21:54"), "id": Node.number(64), "created": Node.string("2014-09-07 21:21:54"), "is_active": Node.number(0), "race_id": Node.number(33), "title": Node.string("Bike"), "type": Node.string("check_in")], ["position": Node.number(1), "modified": Node.string("2014-09-07 21:22:39"), "id": Node.number(67), "created": Node.string("2014-09-07 21:22:39"), "is_active": Node.number(1), "race_id": Node.number(33), "title": Node.string("Helmet"), "type": Node.string("check_in")], ["position": Node.number(2), "modified": Node.string("2014-09-07 21:23:26"), "id": Node.number(70), "created": Node.string("2014-09-07 21:23:26"), "is_active": Node.number(1), "race_id": Node.number(33), "title": Node.string("BLUE bike bag"), "type": Node.string("check_in")], ["position": Node.number(1), "modified": Node.string("2014-09-07 21:27:29"), "id": Node.number(71), "created": Node.string("2014-09-07 21:27:29"), "is_active": Node.number(1), "race_id": Node.number(33), "title": Node.string("WHITE after race bag"), "type": Node.string("race_morning")], ["position": Node.number(2), "modified": Node.string("2014-09-07 21:27:38"), "id": Node.number(73), "created": Node.string("2014-09-07 21:27:38"), "is_active": Node.number(1), "race_id": Node.number(33), "title": Node.string("wetsuit"), "type": Node.string("race_morning")], ["position": Node.number(3), "modified": Node.string("2014-09-07 21:27:48"), "id": Node.number(75), "created": Node.string("2014-09-07 21:27:48"), "is_active": Node.number(1), "race_id": Node.number(33), "title": Node.string("swim goggles"), "type": Node.string("race_morning")], ["position": Node.number(4), "modified": Node.string("2014-09-07 21:28:32"), "id": Node.number(81), "created": Node.string("2014-09-07 21:28:32"), "is_active": Node.number(1), "race_id": Node.number(33), "title": Node.string("Sun glasses"), "type": Node.string("race_morning")], ["position": Node.number(5), "modified": Node.string("2014-09-07 21:28:48"), "id": Node.number(82), "created": Node.string("2014-09-07 21:28:40"), "is_active": Node.number(1), "race_id": Node.number(33), "title": Node.string("Sunblock"), "type": Node.string("race_morning")], ["position": Node.number(6), "modified": Node.string("2014-09-07 21:29:21"), "id": Node.number(83), "created": Node.string("2014-09-07 21:29:21"), "is_active": Node.number(1), "race_id": Node.number(33), "title": Node.string("race number"), "type": Node.string("race_morning")], ["position": Node.number(7), "modified": Node.string("2014-09-07 21:29:53"), "id": Node.number(85), "created": Node.string("2014-09-07 21:29:53"), "is_active": Node.number(1), "race_id": Node.number(33), "title": Node.string("official swim cap"), "type": Node.string("race_morning")], ["position": Node.number(8), "modified": Node.string("2014-09-07 21:30:03"), "id": Node.number(88), "created": Node.string("2014-09-07 21:30:03"), "is_active": Node.number(1), "race_id": Node.number(33), "title": Node.string("timing chip"), "type": Node.string("race_morning")], ["position": Node.number(9), "modified": Node.string("2014-09-07 21:30:52"), "id": Node.number(91), "created": Node.string("2014-09-07 21:30:52"), "is_active": Node.number(1), "race_id": Node.number(33), "title": Node.string("Bike shoes "), "type": Node.string("race_morning")], ["position": Node.number(3), "modified": Node.string("2015-05-27 23:14:48"), "id": Node.number(94), "created": Node.string("2015-05-27 23:14:48"), "is_active": Node.number(1), "race_id": Node.number(33), "title": Node.string("Red run bag"), "type": Node.string("check_in")]]

        try result.forEach({
            let item = $0;
            
            let raceId = try MigrateHelper.oldRaceIdToNew(oldRaceId: item["race_id"]?.int ?? 0)
            
            do {
                let node: [String: Node] = [
                    "race_id": Node(raceId),
                    "title": Node(item["title"]?.string ?? ""),
                    "type": Node(item["type"]?.string ?? ""),
                    "position": Node(item["position"]?.int ?? 0),
                    "is_active": Node(item["is_active"]?.bool ?? false),
                    "updated_at": Node("1970-01-01 00:00:00"), // item["modified"]?.string ??
                    "created_at": Node("1970-01-01 00:00:00") // item["created"]?.string ??
                ]
                
                var checkListItem: CheckListItem = try CheckListItem(node: node)
                try checkListItem.save()
            } catch
            {
                drop.console.error("Could not save traffic entry")
            }
        })


        console.info("Finished the seeder for checklists");
    }
}
